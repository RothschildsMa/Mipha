<?xml version="1.0" encoding="UTF-8"?>

<!DOCTYPE mapper
        PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
        "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
        
<mapper namespace="com.ssm.framework.dao.EmployeeMapper">
    <!-- 全件検索 -->
    <select id="findAll" resultType="com.ssm.framework.entity.Employee">    
        SELECT t1.*, t2.CODE_NAME as DEPATMENT_NAME, t3.CODE_NAME as GENDER_NAME
			FROM T_employee t1
			INNER JOIN m_code t2 ON t1.EMPLOYEE_DEPATMENTID = t2.CODE_ID and t2.CODE_KBN = '0001'
			INNER JOIN m_code t3 ON t1.EMPLOYEE_GENDERID = t3.CODE_ID and t3.CODE_KBN = '0002'
			WHERE t1.DEL_FLG =0;
    </select>
    
    <select id="linkId" resultType="com.ssm.framework.entity.Employee">
        SELECT * FROM T_employee WHERE EMPLOYEE_ID = #{employeeId} AND DEL_FLG = 0
    </select>
    
    <!--条件検索-->
    <select id="iFindByCondition" resultType="com.ssm.framework.entity.Employee">
        SELECT t1.*, t2.CODE_NAME as DEPATMENT_NAME, t3.CODE_NAME as GENDER_NAME
			FROM T_employee t1
			INNER JOIN m_code t2 ON t1.EMPLOYEE_DEPATMENTID = t2.CODE_ID and t2.CODE_KBN = '0001'
			INNER JOIN m_code t3 ON t1.EMPLOYEE_GENDERID = t3.CODE_ID and t3.CODE_KBN = '0002'
		  <where>
		    <if test="employeeId != null and employeeId != ''">
		      AND t1.EMPLOYEE_ID = #{employeeId}
		    </if>
		    <if test="employeeDepatmentId != null and employeeDepatmentId != ''">
            AND t1.EMPLOYEE_DEPATMENTID = #{employeeDepatmentId}
        	</if>
        	<if test="startDate!=null and startDate!=''">
                and t1.JOIN_DATE &gt;= #{startDate}
            </if>
            <if test="endDate !=null and endDate !=''">
                and t1.JOIN_DATE &lt;= #{endDate}
            </if>
            AND t1.DEL_FLG = 0
		  </where>
    </select>
    
    
     <!-- 登録 -->
	<insert id="add">
	  INSERT INTO T_employee (EMPLOYEE_ID, PASSWORD, JOIN_DATE, EMPLOYEE_NAME, EMPLOYEE_NAMEKANA, 
	  EMPLOYEE_GENDERID, EMPLOYEE_AGE, EMPLOYEE_DEPATMENTID, EMPLOYEE_PHONENUMBER, EMPLOYEE_MAIL)
	  VALUES (#{employeeId}, #{password}, #{joinDate}, #{employeeName}, #{employeeNameKana}, #{employeeGenderId},
	   #{employeeAge}, #{employeeDepatmentId}, #{employeePhoneNumber}, #{employeeMail})
	</insert>
	
	<!-- 更新 -->
	<update id="update">
	  UPDATE T_employee SET
	  EMPLOYEE_NAME = #{employeeName}, EMPLOYEE_NAMEKANA = #{employeeNameKana}, 
	  EMPLOYEE_GENDERID = #{employeeGenderId}, EMPLOYEE_AGE = #{employeeAge}, EMPLOYEE_DEPATMENTID = #{employeeDepatmentId}, 
	  EMPLOYEE_PHONENUMBER = #{employeePhoneNumber}, EMPLOYEE_MAIL = #{employeeMail}
	  WHERE EMPLOYEE_ID = #{employeeId}
	</update>
	
	<!-- 削除 -->
	<update id="deleteEmployees">
    UPDATE T_employee SET DEL_FLG = 1 WHERE ID = #{id}
  </update>
  
</mapper>